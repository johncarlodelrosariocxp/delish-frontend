<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/delish-logo.svg" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Responsive viewport - allow all orientations -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.1, viewport-fit=cover"
    />

    <!-- Allow all orientations -->
    <meta name="screen-orientation" content="any" />

    <!-- Standard mobile web app capability -->
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- Apple settings - allow all orientations -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Delish POS" />
    <meta name="apple-mobile-web-app-orientations" content="all" />
    <link rel="apple-touch-icon" href="/delish-logo.svg" />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb" />
    <meta name="description" content="Delish Restaurant Point of Sale System" />

    <!-- Microsoft -->
    <meta name="msapplication-TileColor" content="#2563eb" />
    <meta name="msapplication-TileImage" content="/delish-logo.svg" />

    <title>Delish POS</title>

    <!-- Responsive Design Scripts -->
    <script>
      // Service Worker Registration
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("/sw.js", {
              scope: "/",
              updateViaCache: "none",
            })
            .then(
              function (registration) {
                console.log("ServiceWorker registered:", registration.scope);

                // Check for updates
                registration.addEventListener("updatefound", function () {
                  const newWorker = registration.installing;
                  newWorker.addEventListener("statechange", function () {
                    if (
                      newWorker.state === "installed" &&
                      navigator.serviceWorker.controller
                    ) {
                      console.log("New version available!");
                      if (confirm("New version available! Reload to update?")) {
                        window.location.reload();
                      }
                    }
                  });
                });
              },
              function (err) {
                console.log("ServiceWorker failed:", err);
              }
            );
        });
      }

      // Data Persistence
      let hasUnsavedChanges = false;

      window.markDataChanged = function () {
        hasUnsavedChanges = true;

        // Auto-save after 2 seconds
        setTimeout(function () {
          if (hasUnsavedChanges) {
            window.dispatchEvent(new CustomEvent("saveAppState"));
            hasUnsavedChanges = false;
          }
        }, 2000);
      };

      // Prevent accidental refresh
      window.addEventListener("beforeunload", function (e) {
        if (hasUnsavedChanges) {
          window.dispatchEvent(new CustomEvent("saveAppState"));
          e.preventDefault();
          e.returnValue =
            "You have unsaved changes. Are you sure you want to leave?";
          return e.returnValue;
        }
      });

      // Save on page hide
      document.addEventListener("visibilitychange", function () {
        if (document.visibilityState === "hidden" && hasUnsavedChanges) {
          window.dispatchEvent(new CustomEvent("saveAppState"));
        }
      });

      // PWA Installation
      window.addEventListener("appinstalled", function () {
        console.log("App installed");
        localStorage.setItem("app_installed", "true");
      });

      // Detect PWA mode
      function isRunningAsPWA() {
        return (
          window.matchMedia("(display-mode: standalone)").matches ||
          window.navigator.standalone ||
          document.referrer.includes("android-app://")
        );
      }

      // Network status
      window.addEventListener("online", function () {
        document.body.classList.remove("offline");
        document.body.classList.add("online");
      });

      window.addEventListener("offline", function () {
        document.body.classList.remove("online");
        document.body.classList.add("offline");
      });

      // Initialize
      window.addEventListener("DOMContentLoaded", function () {
        // Load saved data
        const savedState = localStorage.getItem("delish_pos_state");
        if (savedState) {
          window.dispatchEvent(
            new CustomEvent("loadAppState", {
              detail: JSON.parse(savedState),
            })
          );
        }

        // Add PWA class if running as standalone
        if (isRunningAsPWA()) {
          document.body.classList.add("pwa-standalone");
        }
      });
    </script>

    <style>
      /* Base responsive styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      html,
      body {
        width: 100%;
        min-height: 100vh;
        overflow-x: hidden;
        background: #f3f4f6;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Segoe UI", Helvetica, Arial, sans-serif;
      }

      #root {
        width: 100%;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Allow text selection in inputs */
      input,
      textarea,
      [contenteditable="true"] {
        -webkit-user-select: text;
        user-select: text;
      }

      /* Better touch targets for mobile */
      button,
      [role="button"],
      .touch-target {
        min-height: 44px;
        min-width: 44px;
        touch-action: manipulation;
      }

      /* Remove any portrait mode warnings */
      body.portrait-mode #root::before {
        display: none !important;
      }

      /* Network indicators */
      body.offline::after {
        content: "⚠️ Offline";
        position: fixed;
        top: env(safe-area-inset-top, 10px);
        right: 10px;
        background: #ef4444;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 9999;
      }

      body.online::after {
        content: "✓ Online";
        position: fixed;
        top: env(safe-area-inset-top, 10px);
        right: 10px;
        background: #10b981;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 9999;
      }

      /* PWA standalone adjustments */
      body.pwa-standalone {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }

      /* Mobile bottom navigation safe area */
      .bottom-nav-safe {
        padding-bottom: env(safe-area-inset-bottom, 20px);
      }

      /* Responsive table styles */
      .responsive-table {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .responsive-table table {
        min-width: 600px;
      }

      /* Mobile-first responsive design */
      @media (max-width: 768px) {
        html {
          font-size: 14px;
        }

        /* Mobile-optimized styles */
        .mobile-optimized {
          padding: 12px !important;
        }

        .mobile-full-width {
          width: 100% !important;
        }

        .mobile-stack {
          flex-direction: column !important;
        }

        .mobile-stack > * {
          width: 100% !important;
          margin-bottom: 12px !important;
        }

        /* Mobile touch targets */
        .mobile-touch-target {
          padding: 16px !important;
          font-size: 16px !important;
        }
      }

      /* Tablet styles */
      @media (min-width: 769px) and (max-width: 1024px) {
        html {
          font-size: 15px;
        }
      }

      /* Desktop styles */
      @media (min-width: 1025px) {
        html {
          font-size: 16px;
        }
      }

      /* Portrait-specific optimizations */
      @media (orientation: portrait) {
        /* Portrait mode specific styles */
        .portrait-optimized {
          padding: 16px !important;
        }

        /* Ensure full height in portrait */
        .portrait-full-height {
          min-height: 100vh !important;
        }
      }

      /* Landscape-specific optimizations */
      @media (orientation: landscape) {
        /* Landscape mode specific styles */
        .landscape-optimized {
          padding: 20px !important;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <noscript>
      <style>
        #root {
          display: none;
        }
        body::before {
          content: "JavaScript is required to run Delish POS. Please enable JavaScript.";
          display: block;
          padding: 20px;
          text-align: center;
          font-size: 18px;
          color: #666;
        }
      </style>
    </noscript>
  </body>
</html>
